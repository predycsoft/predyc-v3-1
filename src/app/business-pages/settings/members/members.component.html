<div fxLayout="row" fxLayoutGap="20px">
    <div [ngStyle]="{'width': studentSelected ? '80%' : '100%'}">
        <div class="mgl03 mgt10" fxLayout="row" fxLayoutAlign="space-between center">
            <app-search-input-box></app-search-input-box>
            <button *ngIf="!studentSelected" class="blueButton btn radius40" (click)="showAddUserModal(modal)">Agregar usuario</button>
        </div>
        <div class="mgt10">
            <table mat-table [dataSource]="dataSource" matSort>
        
                <!-- Nombre Column -->
                <ng-container matColumnDef="displayName">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Nombre del usuario </th>
                    <td mat-cell *matCellDef="let user"> 
                        <div fxLayout="row" fxLayoutGap="20px" fxLayoutAlign=" center">
                            <img [src]="user.photoUrl" class="avatar2" alt=""
                                onerror="this.src='assets/images/default/default-user-image.jpg'">
                            <span>{{ user.displayName | titlecase }}</span>
                        </div>
                    </td>
                </ng-container>
        
                <!-- Email Column -->
                <ng-container matColumnDef="email">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Correo electrónico </th>
                    <td mat-cell *matCellDef="let user">{{ user.email }}</td>
                </ng-container>
        
                <!-- Status Column -->
                <ng-container matColumnDef="status">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Estatus </th>
                    <td mat-cell *matCellDef="let user"> {{ 'Activo (hardcodeado)' }} </td>
                </ng-container>
        
                <!-- Created Date Column -->
                <ng-container matColumnDef="createdDate">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Fecha de creación </th>
                    <td mat-cell *matCellDef="let user">{{user.createdAt | date: 'dd/MM/yy'}}</td>
                </ng-container>
        
                <!-- Last edited. Column -->
                <ng-container matColumnDef="lastEdited">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Ult. Modificación </th>
                    <td mat-cell *matCellDef="let user"> 
                        <div fxLayout="row" fxLayoutAlign="center center">
                            <span>{{user.updatedAt | date: 'dd/MM/yy'}}</span>
                        </div>
                    </td>
                </ng-container>
        
                <!-- Actions Column -->
                <ng-container matColumnDef="actions">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Acciones administrativas </th>
                    <td mat-cell *matCellDef="let user">
                        <div class="cursorPointer" fxLayout="row" fxLayoutAlign="space-between center" [matMenuTriggerFor]="options" (click)="$event.stopPropagation()">
                            <span style="color: var(--gray-7);" >{{user.role === "admin" ? "Administrador" : "Usuario estándar" }}</span>
                            <img [src]="icon.arrowDown" class="iconButton h32px makeGray" alt="">          
                        </div>
                        <mat-menu #options="matMenu" class="radius6 shadow16 pd0">
                            <div fxLayout="column" class="fw pd0">
                                <div mat-menu-item fxLayout="row" fxLayoutAlign=" center" fxLayoutGap="2rem" 
                                    [ngClass]="user.role === 'admin' ? 'disableOption' : ''"
                                    (click)="user.role === 'admin' ? null : transformUserToAdmin(user)">
                                    <span class="pdl05 ft12 gray-10">Administrador</span>
                                </div> 
                                <div mat-menu-item fxLayout="row" fxLayoutAlign=" center" fxLayoutGap="2rem" 
                                    [ngClass]="user.role === 'student' ? 'disableOption' : ''"
                                    (click)="user.role === 'student' ? null : transformUserToStudent(user)">
                                    <span class="pdl05 ft12 gray-10">Usuario estándar</span>
                                </div>
                            </div>
                        </mat-menu>
                    </td>
                </ng-container>
        
                <!-- Delete Column -->
                <ng-container matColumnDef="delete">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header></th>
                    <td mat-cell *matCellDef="let user">                         
                        <div fxLayout="row" fxLayoutAlign="center center" class="cursorPointer" (click)="onDeleteUser(user)">
                            <img [src]="icon.trash" class="h16px makeGray" alt="">
                        </div> 
                    </td>
                </ng-container>
        
                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let user; columns: displayedColumns;"></tr>
        
                <!-- Row shown when there is no matching data. -->
                <tr class="mat-row" *matNoDataRow>
                    <td class="mat-cell" colspan="4">No se han encontrado usuarios para el criterio de busqueda</td>
                </tr>
            </table>
            
            <!-- [hidePageSize]="true"
            [pageSizeOptions]="[5, 10, 15]" -->
            <mat-paginator
                aria-label="Select page of users"
                ></mat-paginator>
        </div>
    </div>
    <app-student-profile *ngIf="studentSelected" [student]="studentSelected" [isStudentProfile]="false" 
        (hideEmit)="studentSelected = null" (onStudentSave)="onStudentSaveHandler($event)" class="w300px mgb10 mgt10">
    </app-student-profile>
</div>


<!-- MODAL -->
<ng-template #modal let-modal>
    <div class="modal-header bg-web-primary text-white px-3 py-1">
        <div class="modal-title pd10" fxLayout="row" fxLayoutAlign="start center">
            <span class="ft16 ft600 gray-10">Crear nuevo usuario</span>
        </div>
        <img style="cursor: pointer;" [src]="icon.close" (click)="modal.dismiss('Cross click')" class="h20px" alt="">
    </div>
    <div class="modal-body pd20">
        <p>¿Deseas crear un usuario para <span class="ft600 gray-10">Mi Equipo</span> o solamente como <span class="ft600 gray-10">Administrador</span>?</p>
        <p>Recuerda que crear un usuario como parte de <span class="ft600 gray-10">Mi Equipo</span> le permitirá acceder como usuario estandar</p>
        <div class="dialog-buttons" fxLayout="row" fxLayoutAlign="center center" fxLayoutGap="8px">
            <button class="blueButton radius40" (click)="navigateToMyTeam()">Crear en Mi Equipo</button>
            <span>o</span>
            <button class="blueButton radius40" (click)="createNewStudent()">Crear como Administrador</button>
        </div>
    </div>
</ng-template>
