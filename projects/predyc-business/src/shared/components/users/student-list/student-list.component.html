<div class="">
    <table mat-table [dataSource]="dataSource">

        <!-- Nombre Column -->
        <ng-container matColumnDef="displayName">

            <th mat-header-cell *matHeaderCellDef class="ft14 centertext"> 
                <div
                class="cursorPointer"
                fxLayout="row"
                [ngClass]="{'chip pdl05':sortNombre}"
                [matMenuTriggerFor]="menufiltroName"
                fxLayoutAlign="center center" >
                <!-- <span  [ngClass]="{'gray-9':filtroDepartamento}" class="gray-7">Departamento</span>
                <mat-icon [ngClass]="{'gray-9':filtroDepartamento}">expand_more</mat-icon> -->
                <span  class="gray-7">Nombre</span>
                <mat-icon>expand_more</mat-icon>
              </div>
            </th>

            <!-- <th mat-header-cell *matHeaderCellDef class="gray-8"> Nombre </th> -->
            <td mat-cell *matCellDef="let user"> 
                <div fxLayout="row" fxLayoutGap="20px" fxLayoutAlign=" center" >
                    <img
                        [src]="user.photoUrl ? user.photoUrl : 'assets/images/default/default-user-image.jpg'"
                        class="avatar2"
                        alt=""
                        >
                    <div fxLayout="column" fxLayoutAlign="center ">
                        <div class="ft500 ft14  gray-10">{{ user.displayName | titlecase }}</div>
                        <div
                        *ngIf="!user.profile"
                            class="ft400 ft13 gray-6">
                            Perfil sin asignar
                        </div>
                        <div
                            *ngIf="user.profile" fxLayout="row" fxLayoutGap="5px"  >
                            <div *ngIf="user.profile" class="ft400 ft13 blue-4" >
                                {{ user.profile  | titlecase }}
                            </div>
                            <!-- <img [src]="icon.arrowForward" alt="Forward Arrow" class="makeBlue" > -->
                        </div>
                    </div>
                </div>
            </td>
        </ng-container>

        <!-- Department Column -->
        <ng-container matColumnDef="contacto" class=" ">
            <th mat-header-cell *matHeaderCellDef class="ft14 centertext"> Contacto </th>
            <td mat-cell *matCellDef="let user" class=""> 
            <div (click)="$event.stopPropagation();">
                <a (click)="copiarContacto('Correo copiado',user.mail)" [href]="'mailto:' + user.mail" class="contact-link gray-7 ft400">{{ user.mail }}</a>
            </div>
            <div *ngIf="user.phone" class="" (click)="$event.stopPropagation();">
                <a (click)="copiarContacto('Teléfono copiado',user.phone)" [href]="'https://wa.me/' + user.phone" target="_blank" class="contact-link gray-7 ft400 centertext">Tel: {{ user.phone }}</a>
            </div>
            </td>
        </ng-container>

        <!-- Department Column -->
        <ng-container matColumnDef="department" class=" ">
            <th mat-header-cell *matHeaderCellDef class="ft14 centertext"> 
                <div
                class="cursorPointer"
                fxLayout="row"
                [ngClass]="{'chip pdl05':filtroDepartamento || sortDepartamento}"
                [matMenuTriggerFor]="menuFilterDepartamento"
                fxLayoutAlign="center center" >
                <!-- <span  [ngClass]="{'gray-9':filtroDepartamento}" class="gray-7">Departamento</span>
                <mat-icon [ngClass]="{'gray-9':filtroDepartamento}">expand_more</mat-icon> -->
                <span  class="gray-7">Departamento</span>
                <mat-icon>expand_more</mat-icon>
              </div>
            </th>
            <!-- <th mat-header-cell *matHeaderCellDef class="ft14 centertext"> Departamento </th> -->
            <td mat-cell *matCellDef="let user" class="centertext"> 
                <div>
                    <span class="gray-7 ft400" >{{user.department}}</span>
                </div>
        
            </td>

            <!-- <th mat-header-cell *matHeaderCellDef class="gray-8"> Departamento </th> -->
            <!-- <td mat-cell *matCellDef="let user" class="ft14"> {{user.department}} </td> -->
        </ng-container>

        <!-- Hours Column -->
        <ng-container matColumnDef="hours">

            <th mat-header-cell *matHeaderCellDef class="ft14 centertext"> 

                <div
                class="cursorPointer"
                fxLayout="row"
                [ngClass]="{'chip pdl05': sortHoras}"
                [matMenuTriggerFor]="menufiltroHoras"
                fxLayoutAlign="center center" >
                <span  class="gray-7">Horas</span>
                <mat-icon>expand_more</mat-icon>
              </div>
            </th>
            <td mat-cell *matCellDef="let user" class="centertext"> 
                <div>
                    <span class="gray-7 ft400" >{{user.hours/60 | number : "1.0-0"  }}&nbsp;/&nbsp;{{user.targetHours | number : "1.0-0" }}</span>
                </div>
        
            </td>
            <!-- <td mat-cell *matCellDef="let user" class="ft14">{{user.hours/60 | number : "1.0-0"  }}&nbsp;/&nbsp;{{user.targetHours | number : "1.0-0" }}</td> -->
        </ng-container>


        <!-- Hours Column -->
        <ng-container matColumnDef="dates">
            <th mat-header-cell *matHeaderCellDef class="ft14 centertext"> 

                <div
                class="cursorPointer"
                fxLayout="row"
                [ngClass]="{'chip pdl05': sortDatesPlan}"
                [matMenuTriggerFor]="menufiltroDates"
                fxLayoutAlign="center center" >
                <span  class="gray-7">Fechas</span>
                <mat-icon>expand_more</mat-icon>
              </div>
            </th>
            <td mat-cell *matCellDef="let user" class="centertext"> 
                <div>
                    <span class="gray-7 ft400" >{{user.dataStarPlan | date : 'MMM yy' }} - {{user.dataEndPlan | date : 'MMM yy'}}</span>
                </div>
        
            </td>
            <!-- <td mat-cell *matCellDef="let user" class="ft14">{{user.hours/60 | number : "1.0-0"  }}&nbsp;/&nbsp;{{user.targetHours | number : "1.0-0" }}</td> -->
        </ng-container>

        <!-- Hours Column -->
        <ng-container matColumnDef="ultActivity">
            <th mat-header-cell *matHeaderCellDef class="ft14 centertext"> 

                <div
                class="cursorPointer"
                fxLayout="row"
                [ngClass]="{'chip pdl05':filtroUltimaActividad || sortUltimaActividad}"
                [matMenuTriggerFor]="menufiltroUltimaActividad"
                fxLayoutAlign="center center" >
                <span  class="gray-7">Ult. Act.	</span>
                <mat-icon>expand_more</mat-icon>
              </div>

            </th>
            <td mat-cell *matCellDef="let user" class="centertext">
                <ng-container *ngIf="!user.lastActivityText">
                  <span class="gray-7 ft400">{{user.activityStatusText}}</span>
                </ng-container>
                <ng-container *ngIf="user.lastActivityText">
                  <div class="gray-7 ft400">{{user.lastActivityText}}</div>
                  <div class="gray-7" style="font-size: 10px !important;">({{user.activityStatusText}})</div>
                </ng-container>
              </td>
          </ng-container>
          

        
        <!-- RatingPoints Column -->
        <ng-container matColumnDef="ratingPoints">

            <th mat-header-cell *matHeaderCellDef class="ft14 centertext"> 

                <div
                class="cursorPointer"
                fxLayout="row"
                [ngClass]="{'chip': sortRatingPoints}"
                [matMenuTriggerFor]="menufiltroratingPoints"
                fxLayoutAlign="center center" >
                <span  class="gray-7">Comp.	</span>
                <mat-icon>expand_more</mat-icon>
              </div>

            </th>


            <td mat-cell *matCellDef="let user" class="centertext"> 
                <div>
                    <span *ngIf="user.ratingPoints>=0" class="gray-7 ft400" >{{ user.ratingPoints | number: "1.0-0" }} %</span>
                    <span *ngIf="user.ratingPoints<0" class="gray-7 ft400" > - </span>
                </div>
        
            </td>


            <!-- <th mat-header-cell *matHeaderCellDef class="centertext gray-8" > Puntaje </th> -->
            <!-- <td mat-cell *matCellDef="let user" class="centertext ft14"> {{ user.ratingPoints | number: "1.0-0" }} </td> -->
        </ng-container>

        <!-- Rhythm Column -->
        <ng-container matColumnDef="rhythm" class="centertext">
            <th mat-header-cell *matHeaderCellDef class="ft14 centertext"> 
                <div
                class="cursorPointer"
                fxLayout="row"
                [ngClass]="{'chip':ritmoFilter || sortRitmo}"
                [matMenuTriggerFor]="menuFilterRitmo"
                fxLayoutAlign="center center" >
                <!-- <span  [ngClass]="{'gray-9':ritmoFilter}" class="gray-7">Ritmo</span>
                <mat-icon [ngClass]="{'gray-9':ritmoFilter}">expand_more</mat-icon> -->
                <span  class="gray-7">Ritmo</span>
                <mat-icon >expand_more</mat-icon>
              </div>
            </th>
            <!-- <th mat-header-cell *matHeaderCellDef class="w-10 centertext gray-8"> Ritmo </th> -->
            <td mat-cell *matCellDef="let user" style="width: 12%;"> 
                <div *ngIf="user.rhythm === 'high'" class="chip backGreen2"  fxLayout="row" fxLayoutAlign="center center">
                    <span class="ft13 nowrap ft500  " style="color: var(--green-5);">Alto</span>
                </div>
                <div *ngIf="user.rhythm === 'medium'" class="chip newYellow2b "   fxLayout="row" fxLayoutAlign="center center">
                    <span class="ft13 nowrap ft500 " style="color: rgb(221, 144, 0);" >Medio</span>
                </div>
                <div *ngIf="user.rhythm === 'low'" class="chip backRed1 " fxLayout="row" fxLayoutAlign="center center">
                    <span class="ft13 nowrap ft500 red-5 " >Bajo</span>
                </div>
                <div *ngIf="user.rhythm === 'no plan'" class="chip backGray3"  fxLayout="row" fxLayoutAlign="center center" style="background-color: #ff999961;">
                    <img [src]="icon.warning" alt="" class=" pdr08   h12px" >
                    <span class="ft13 nowrap ft500 gray-8">Sin plan</span>
                </div>
                <div matTooltip="No ha presentado la prueba diagnóstica" *ngIf="user.rhythm === 'no iniciado' && user.test.length==0 && this.examenInicial" class="chip backGray3 "  fxLayout="row" fxLayoutAlign="center center" style="background-color: #ff999961;">
                    <!-- <img [src]="icon.warning" alt="" class="pdl03 pdr03" > -->
                    <span *ngIf="user" class="ft13 nowrap ft500 gray-8">Sin Diagnostico</span>
                </div>
                <div *ngIf="user.rhythm === 'no iniciado' && (user.test.length>0 || !this.examenInicial) "  class="chip backGray3 "   fxLayout="row" fxLayoutAlign="center center">
                    <!-- <img [src]="icon.warning" alt="" class="pdl03 pdr03" > -->
                    <span class="ft13 nowrap ft500 gray-8"  >Sin Clases</span>
                </div>
                <div *ngIf="user.rhythm === 'SinLicencia' "  class="chip backGray3 "   fxLayout="row" fxLayoutAlign="center center">
                    <!-- <img [src]="icon.warning" alt="" class="pdl03 pdr03" > -->
                    <span class="ft13 nowrap ft500 gray-8"  >Sin Licencia</span>
                </div>
            </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <ng-container>
            <tr mat-row
                *matRowDef="let user; columns: displayedColumns;"
                (click)="onSelectUser(user)"
                class="cursorPointer move-right"
                [ngClass]="{'inactive-row': user.status === 'inactive' && statusFilter!='inactive'}">
            </tr>
          </ng-container>

        <!-- Row shown when there is no matching data. -->
        <tr class="mat-row" *matNoDataRow>
            <td class="mat-cell" colspan="8">No se han encontrado usuarios para el criterio de busqueda</td>
        </tr>
    </table>

    <mat-paginator
        aria-label="Select page of users"
        [pageSize]="pageSize"
        [length]="totalLength"
        (page)="onPageChange($event.pageIndex + 1)"
        ></mat-paginator>
</div>


<mat-menu #menuFilterRitmo="matMenu" class="radius6 shadow16 pd0">
    <div fxLayout="column" class="pd0">
      <div
        mat-menu-item
        class="opcionMenu"
        fxLayout="row"
        fxLayoutAlign=" center"
        (click)="search('sortRitmo','up')" [ngClass]="sortRitmo == 'up' ? 'backGray2 green-5 ft500' : 'gray-10' ">
        <img [src]="icon.sortAscending" alt="" class="h16px mg0">
        <span class="pdl05">A - Z</span>
        </div>
        <div
            mat-menu-item
            class="opcionMenu"
            fxLayout="row"
            fxLayoutAlign=" center"
            (click)="search('sortRitmo','down')" [ngClass]="sortRitmo == 'down' ? 'backGray2 green-5 ft500' : 'gray-10' ">
            <img [src]="icon.sortDescending" alt="" class="h16px mg0">
            <span class="pdl05">Z - A</span>
        </div>
        <div
        mat-menu-item
        class="opcionMenu"
        fxLayout="row"
        fxLayoutAlign=" center"
        (click)="clearRitmo()" [ngClass]="ritmoFilter == '' ? 'backGray2 green-5 ft500' : 'gray-10' ">
        <span class="pdl05">Todos</span>
      </div>
      <div
        mat-menu-item
        class="opcionMenu"
        fxLayout="row"
        fxLayoutAlign=" center"
        (click)="search('ritmo','high')"
        [ngClass]=" ritmoFilter == 'high' ? 'backGray2 green-5 ft500' : 'gray-10'">
        <span class="pdl05">Alto</span>
      </div>
        <div
            mat-menu-item
            class="opcionMenu"
            fxLayout="row"
            fxLayoutAlign=" center"
            (click)="search('ritmo','medium')"
            [ngClass]=" ritmoFilter == 'medium' ? 'backGray2 green-5 ft500' : 'gray-10'">
            <span class="pdl05">Medio</span>
        </div>
        <div
            mat-menu-item
            class="opcionMenu"
            fxLayout="row"
            fxLayoutAlign=" center"
            (click)="search('ritmo','low')"
            [ngClass]=" ritmoFilter == 'low' ? 'backGray2 green-5 ft500' : 'gray-10'">
            <span class="pdl05">Bajo</span>
        </div>
        <div
            mat-menu-item
            class="opcionMenu"
            fxLayout="row"
            fxLayoutAlign=" center"
            (click)="search('ritmo','no iniciado')"
            [ngClass]=" ritmoFilter == 'no iniciado' ? 'backGray2 green-5 ft500' : 'gray-10'">
            <span class="pdl05">No iniciado</span>
        </div>
        <div
        mat-menu-item
        class="opcionMenu"
        fxLayout="row"
        fxLayoutAlign=" center"
        (click)="search('ritmo','no plan')"
        [ngClass]=" ritmoFilter == 'no plan' ? 'backGray2 green-5 ft500' : 'gray-10'">
        <span class="pdl05">Sin plan</span>
    </div>
    </div>
</mat-menu>


<mat-menu #menuFilterDepartamento="matMenu" class="radius6 shadow16 pd0">
    <div fxLayout="column" class="pd0">
        <div
        mat-menu-item
        class="opcionMenu"
        fxLayout="row"
        fxLayoutAlign=" center"
        (click)="search('sortDepartamento','up')" [ngClass]="sortDepartamento == 'up' ? 'backGray2 green-5 ft500' : 'gray-10' ">
        <img [src]="icon.sortAscending" alt="" class="h16px mg0">
        <span class="pdl05">A - Z</span>
        </div>
        <div
            mat-menu-item
            class="opcionMenu"
            fxLayout="row"
            fxLayoutAlign=" center"
            (click)="search('sortDepartamento','down')" [ngClass]="sortDepartamento == 'down' ? 'backGray2 green-5 ft500' : 'gray-10' ">
            <img [src]="icon.sortDescending" alt="" class="h16px mg0">
            <span class="pdl05">Z - A</span>
        </div>
      <div
        mat-menu-item
        class="opcionMenu"
        fxLayout="row"
        fxLayoutAlign=" center"
        (click)="cleanDepartments()" [ngClass]="filtroDepartamento == '' ? 'backGray2 green-5 ft500' : 'gray-10' ">
        <span class="pdl05">Todos</span>
      </div>
      <div
        *ngFor="let departamneto of departments"
        mat-menu-item
        class="opcionMenu"
        fxLayout="row"
        fxLayoutAlign=" center"
        (click)="search('iddepartment',departamneto.id)"
        [ngClass]=" filtroDepartamento == departamneto.id ? 'backGray2 green-5 ft500' : 'gray-10'">
        <span class="pdl05">{{departamneto.name}}</span>
      </div>
    </div>
</mat-menu>

<mat-menu #menufiltroUltimaActividad="matMenu" class="radius6 shadow16 pd0">
    <div fxLayout="column" class="pd0">
        <div
            mat-menu-item
            class="opcionMenu"
            fxLayout="row"
            fxLayoutAlign=" center"
            (click)="search('sortUltimaActividad','up')" [ngClass]="sortUltimaActividad == 'up' ? 'backGray2 green-5 ft500' : 'gray-10' ">
            <img [src]="icon.sortAscending" alt="" class="h16px mg0">
            <span class="pdl05">A - Z</span>
        </div>
        <div
            mat-menu-item
            class="opcionMenu"
            fxLayout="row"
            fxLayoutAlign=" center"
            (click)="search('sortUltimaActividad','down')" [ngClass]="sortUltimaActividad == 'down' ? 'backGray2 green-5 ft500' : 'gray-10' ">
            <img [src]="icon.sortDescending" alt="" class="h16px mg0">
            <span class="pdl05">Z - A</span>
        </div>
        <div
            mat-menu-item
            class="opcionMenu"
            fxLayout="row"
            fxLayoutAlign=" center"
            (click)="clearUltActividad()" [ngClass]="filtroUltimaActividad == '' ? 'backGray2 green-5 ft500' : 'gray-10' ">
            <span class="pdl05">Todos</span>
        </div>
        <div
            *ngFor="let actStatusItem of actStatusDaus"
            mat-menu-item
            class="opcionMenu"
            fxLayout="row"
            [ngClass]=" filtroUltimaActividad == actStatusItem ? 'backGray2 green-5 ft500' : 'gray-10'"
            (click)="search('ultActivity',actStatusItem)"
            fxLayoutAlign=" center">
            <span class="pdl05">{{actStatusItem}}</span>
        </div>
        <div
            *ngFor="let actStatusItem of actStatus"
            mat-menu-item
            class="opcionMenu"
            fxLayout="row"
            [ngClass]=" filtroUltimaActividad == actStatusItem ? 'backGray2 green-5 ft500' : 'gray-10'"
            (click)="search('ultActivity',actStatusItem)"
            fxLayoutAlign=" center">
            <span class="pdl05">{{actStatusItem}}</span>
        </div>


    </div>
</mat-menu>



<mat-menu #menufiltroratingPoints="matMenu" class="radius6 shadow16 pd0">
    <div fxLayout="column" class="pd0">
        <div
            mat-menu-item
            class="opcionMenu"
            fxLayout="row"
            fxLayoutAlign=" center"
            (click)="search('sortRatingPoints','up')" [ngClass]="sortRatingPoints == 'up' ? 'backGray2 green-5 ft500' : 'gray-10' ">
            <img [src]="icon.sortAscending" alt="" class="h16px mg0">
            <span class="pdl05">A - Z</span>
        </div>
        <div
            mat-menu-item
            class="opcionMenu"
            fxLayout="row"
            fxLayoutAlign=" center"
            (click)="search('sortRatingPoints','down')" [ngClass]="sortRatingPoints == 'down' ? 'backGray2 green-5 ft500' : 'gray-10' ">
            <img [src]="icon.sortDescending" alt="" class="h16px mg0">
            <span class="pdl05">Z - A</span>
        </div>
        <div
            mat-menu-item
            class="opcionMenu"
            fxLayout="row"
            fxLayoutAlign=" center"
            (click)="search('sortRatingPoints','')">
            <img [src]="icon.trash" alt="" class="h16px mg0">
            <span class="pdl05">Quitar</span>
        </div>
    </div>
</mat-menu>


<mat-menu #menufiltroDates="matMenu" class="radius6 shadow16 pd0">
    <div fxLayout="column" class="pd0">
        <div
            mat-menu-item
            class="opcionMenu"
            fxLayout="row"
            fxLayoutAlign=" center"
            (click)="search('sortDatesPlan','up')" [ngClass]="sortDatesPlan == 'up' ? 'backGray2 green-5 ft500' : 'gray-10' ">
            <img [src]="icon.sortAscending" alt="" class="h16px mg0">
            <span class="pdl05">A - Z</span>
        </div>
        <div
            mat-menu-item
            class="opcionMenu"
            fxLayout="row"
            fxLayoutAlign=" center"
            (click)="search('sortDatesPlan','down')" [ngClass]="sortDatesPlan == 'down' ? 'backGray2 green-5 ft500' : 'gray-10' ">
            <img [src]="icon.sortDescending" alt="" class="h16px mg0">
            <span class="pdl05">Z - A</span>
        </div>
        <div
            mat-menu-item
            class="opcionMenu"
            fxLayout="row"
            fxLayoutAlign=" center"
            (click)="search('sortDatesPlan','')">
            <img [src]="icon.trash" alt="" class="h16px mg0">
            <span class="pdl05">Quitar</span>
        </div>
    </div>
</mat-menu>


<mat-menu #menufiltroHoras="matMenu" class="radius6 shadow16 pd0">
    <div fxLayout="column" class="pd0">
        <div
            mat-menu-item
            class="opcionMenu"
            fxLayout="row"
            fxLayoutAlign=" center"
            (click)="search('sortHoras','up')" [ngClass]="sortHoras == 'up' ? 'backGray2 green-5 ft500' : 'gray-10' ">
            <img [src]="icon.sortAscending" alt="" class="h16px mg0">
            <span class="pdl05">A - Z</span>
        </div>
        <div
            mat-menu-item
            class="opcionMenu"
            fxLayout="row"
            fxLayoutAlign=" center"
            (click)="search('sortHoras','down')" [ngClass]="sortHoras == 'down' ? 'backGray2 green-5 ft500' : 'gray-10' ">
            <img [src]="icon.sortDescending" alt="" class="h16px mg0">
            <span class="pdl05">Z - A</span>
        </div>
        <div
            mat-menu-item
            class="opcionMenu"
            fxLayout="row"
            fxLayoutAlign=" center"
            (click)="search('sortHoras','')">
            <img [src]="icon.trash" alt="" class="h16px mg0">
            <span class="pdl05">Quitar</span>
        </div>
    </div>
</mat-menu>

<mat-menu #menufiltroName="matMenu" class="radius6 shadow16 pd0">
    <div fxLayout="column" class="pd0">
        <div
            mat-menu-item
            class="opcionMenu"
            fxLayout="row"
            fxLayoutAlign=" center"
            (click)="search('sortNombre','up')" [ngClass]="sortNombre == 'up' ? 'backGray2 green-5 ft500' : 'gray-10' ">
            <img [src]="icon.sortAscending" alt="" class="h16px mg0">
            <span class="pdl05">A - Z</span>
        </div>
        <div
            mat-menu-item
            class="opcionMenu"
            fxLayout="row"
            fxLayoutAlign=" center"
            (click)="search('sortNombre','down')" [ngClass]="sortNombre == 'down' ? 'backGray2 green-5 ft500' : 'gray-10' ">
            <img [src]="icon.sortDescending" alt="" class="h16px mg0">
            <span class="pdl05">Z - A</span>
        </div>
        <div
            mat-menu-item
            class="opcionMenu"
            fxLayout="row"
            fxLayoutAlign=" center"
            (click)="search('sortNombre','')">
            <img [src]="icon.trash" alt="" class="h16px mg0">
            <span class="pdl05">Quitar</span>
        </div>
    </div>
</mat-menu>




  
  