<ng-container *ngIf="!formNewCourse">
    <div style="display: flex; justify-content: center; align-items: center; height: 100%;">
        <mat-spinner class="spinner-dark" diameter="50"></mat-spinner>
    </div>
</ng-container>

<ng-container *ngIf="formNewCourse">
    <div class="fw" class="fw fh backWhite radius10" fxLayout="column">    <div [ngClass]="true ? 'header--edit' : ''" fxLayout="row" fxLayoutAlign="space-between " class="header pdr20 pdl10">
        <div fxLayout="row" fxLayoutAlign="space-between center" class="fw fh pdt05 pdb05"  >
            <div fxLayout="row" fxLayoutAlign="start center">
                <div *ngIf="formNewCourse?.get('titulo')?.value"  class="radius20 pdl10 pdr10 mgr10 pdt05 pdb05 backWhite ft14 fh pdl05  " fxLayout="row" fxLayoutGap="8px" fxLayoutAlign=" center">
                    <span class="input-box ft14" placeholder="Nombre del diplomado"  >{{formNewCourse?.get('titulo')?.value}}</span>
                </div>
                <ng-container *ngIf="formNewCourse">
                    <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="20px">
                        <div fxLayout="row" fxLayoutAlign="start center">
                            <input
                            (change)="changeBorrador($event)"
                            type="checkbox" 
                            [checked]="formNewCourse?.get('proximamente')?.value">
                            <label style="padding-left: 5px; color:white">Borrador</label>
                        </div>
                        <div fxLayout="row" fxLayoutAlign="start center">
                            <input
                            (change)="changePublic($event)"
                            type="checkbox" 
                            [checked]="formNewCourse?.get('public')?.value">
                            <label style="padding-left: 5px; color:white">Es público</label>
                        </div>
                        <div fxLayout="row" fxLayoutAlign="start center">
                            <input
                            (change)="changeEnCalendario($event)"
                            type="checkbox" 
                            [checked]="formNewCourse?.get('enCalendario')?.value">
                            <label style="padding-left: 5px; color:white">En calendario</label>
                        </div>
                        <div  *ngIf="user.isSystemUser" fxLayout="row" fxLayoutAlign="start center">
                            <button
                                fxLayout="row"
                                fxLayoutGap="0.625"
                                fxLayoutAlign="center center"
                                (click)="descargarPDF()"
                                class="blueButton ft14 cursorPointer"
                                style="border-radius: 24px !important;">
                                Descargar PDF
                                <img [src]="icon.download" class="h16px pdl05 makeWhite" alt="">
                            </button>                        
                        </div>
                    </div>
                </ng-container>
            </div>
            <div fxLayout="row" fxLayoutGap="10px" fxLayoutAlign=" center">
                <div class="radius20 pdl10 pdr10 pdt05 pdb05 backWhite ft14 cursorPointer" routerLink="/management/courses"> 
                    Cancelar
                </div>
                <button
                    fxLayout="row"
                    fxLayoutGap="0.625"
                    fxLayoutAlign="center center"
                    class="blueButton ft14 cursorPointer"
                    (click)="saveDraftPre()"
                    style="border-radius: 24px !important;">
                    {{mode !== 'edit' ? 'Guardar diplomado' : 'Guardar diplomado'}}
                    <img [src]="icon.save" class="h16px pdl05 makeWhite" alt="">
                </button>
            </div>
        </div>
    </div>
        <div class="fh " >
            <mat-tab-group mat-stretch-tabs="false" class="swal-overlay pdt35 " (selectedTabChange)="onTabChange($event)" style="z-index: 2; position :fixed;  width: 97%;" >
                <mat-tab label="Contenido del diplomado"  style="z-index: 2; position :fixed;" >
                    <ng-container >
                        <div fxLayout="row" class=" " fxLayoutGap=""  style="overflow-y: auto; height: 80vh !important; width: 100%; ">
                            <!-- <div fxFlex="50%" class="pdl10 pdt10 fw"> -->
                            <div *ngIf="formNewCourse" class="radius10 w-30 mgt15 mgb10 mgl10 shadowLight" fxLayout="column" style="background-color: rgba(244, 244, 244, 0.362); height: fit-content;">
                                <!-- Informacion -->
                                <form [formGroup]="formNewCourse" class="mgl10 mgt15 mgr10 mgb20">
                                    <div class="fw" fxLayoutAlign="space-between center" fxLayout="row">
                                        <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap=".5rem" class="">
                                            <img [src]="icon.presentationFile" class="makeBlue h20px" alt="">
                                            <span class="ft500 ft14 black " style="margin-top: 5px;">Informacion general del diplomado</span>
                                        </div>
                                    </div>
                                    <div class="form-group mgt08 mgb08">
                                        <label class="ft12 " >Título</label>
                                        <input
                                        [class.is-invalid]="formNewCourse.controls['titulo'].errors && showErrorCurso"
                                        formControlName="titulo" type="text" class="form-control customInput2 radius6 " placeholder="Escriba el título del diplomado aquí">
                                        <div class="invalid-feedback" *ngIf="formNewCourse.controls['titulo'].errors && showErrorCurso"> 
                                            Debe indicar el título del diplo
                                        </div>
                                    </div>
                                    <mat-accordion>
                                        <mat-expansion-panel>
                                            <mat-expansion-panel-header>
                                                <mat-panel-title>
                                                    Meta datos
                                                </mat-panel-title>
                                            </mat-expansion-panel-header>
                                    
                                            <div *ngIf="user.isSystemUser" class="ft12 form-group pdt10">
                                                <label>Precio</label>
                                                <input formControlName="precio"
                                                       [class.is-invalid]="formNewCourse.controls['precio'].errors && showErrorCurso"
                                                       type="number" min="1" class="form-control customInput2">
                                                <div class="invalid-feedback" *ngIf="formNewCourse.controls['precio'].errors && showErrorCurso"> 
                                                    Debe indicar la descripción del diplomado
                                                </div>
                                            </div>
                                    
                                            <div *ngIf="user.isSystemUser" class="ft12 form-group pdt10">
                                                <label>Precio con descuento</label>
                                                <input formControlName="precioOferta"
                                                       [class.is-invalid]="formNewCourse.controls['precioOferta'].errors && showErrorCurso"
                                                       type="number" min="1" class="form-control customInput2">
                                                <div class="invalid-feedback" *ngIf="formNewCourse.controls['precioOferta'].errors && showErrorCurso"> 
                                                    Debe indicar la descripción del diplomado
                                                </div>
                                            </div>
                                    
                                            <div *ngIf="user.isSystemUser" class="ft12 form-group pdt10">
                                                <label>Enlace Stripe</label>
                                                <input formControlName="stripeUrl"
                                                       [class.is-invalid]="formNewCourse.controls['precioOferta'].errors && showErrorCurso"
                                                       type="text" class="form-control customInput2">
                                                <div class="invalid-feedback" *ngIf="formNewCourse.controls['precioOferta'].errors && showErrorCurso"> 
                                                    Debe indicar la descripción del diplomado
                                                </div>
                                            </div>
                                    
                                            <div *ngIf="user.isSystemUser" class="ft12 form-group pdt10">
                                                <label>Meta descripción del diplomado</label>
                                                <textarea [class.is-invalid]="formNewCourse.controls['metaDescripcion'].errors && showErrorCurso" rows="3"
                                                          formControlName="metaDescripcion" type="text" class="form-control ft12 customInput2"
                                                          [maxLength]="metaDescriptionMaxLength"
                                                          placeholder="Escriba la descripción del diplomado aquí" style="resize: none;"></textarea>
                                                <div class="progress-bar-container fw mgt03">
                                                    <div class="progress-bar" [style.width.%]="(formNewCourse?.controls['metaDescripcion']?.value?.length / metaDescriptionMaxLength) * 100"></div>
                                                </div>
                                                <div class="invalid-feedback" *ngIf="formNewCourse.controls['metaDescripcion'].errors && showErrorCurso"> 
                                                    Debe indicar la meta descripción del diplomado
                                                </div>
                                            </div>
                                    
                                            <div *ngIf="user.isSystemUser" class="ft12 form-group pdt10">
                                                <label>KeyWords</label>
                                                <textarea [class.is-invalid]="formNewCourse.controls['KeyWords'].errors && showErrorCurso" [maxLength]="keyWordsMaxLength"
                                                          rows="3" formControlName="KeyWords" type="text" class="form-control ft12 customInput2"
                                                          placeholder="Escriba los KeyWords del diplomado aquí" style="resize: none;"></textarea>
                                                <div class="progress-bar-container fw mgt03">
                                                    <div class="progress-bar" [style.width.%]="(formNewCourse?.controls['KeyWords']?.value?.length / keyWordsMaxLength) * 100"></div>
                                                </div>
                                                <div class="invalid-feedback" *ngIf="formNewCourse.controls['KeyWords'].errors && showErrorCurso"> 
                                                    Debe indicar los KeyWords del diplomado
                                                </div>
                                            </div>
                                    
                                        </mat-expansion-panel>
                                    </mat-accordion>

                                    <div class="form-group mgt08">
                                        <label class="ft12 " >Objetivo</label>
                                        <textarea
                                        [class.is-invalid]="formNewCourse.controls['objetivo'].errors && showErrorCurso"
                                        formControlName="objetivo" 
                                        class="form-control customInput2 radius6" 
                                        placeholder="Escriba el objetivo del diplomado aqui"
                                        rows="3"></textarea>
                                        <div class="invalid-feedback" *ngIf="formNewCourse.controls['objetivo'].errors && showErrorCurso"> 
                                            Debe indicar el detalle de la modalidad de capacitación
                                        </div>
                                    </div>

                                    <div class="form-group mgt08">
                                        <label class="ft12 " >Proyecto Final</label>
                                        <textarea
                                        [class.is-invalid]="formNewCourse.controls['final'].errors && showErrorCurso"
                                        formControlName="final" 
                                        class="form-control customInput2 radius6" 
                                        placeholder="Escriba el final del diplomado aquí"
                                        rows="3"></textarea>
                                        <div class="invalid-feedback" *ngIf="formNewCourse.controls['final'].errors && showErrorCurso"> 
                                            Debe indicar el detalle de lal proyecto final
                                        </div>
                                    </div>
                                    
                                    <div class="form-group mgt08">
                                        <label class="ft12 " >Modalidad</label>
                                        <select
                                            [class.is-invalid]="formNewCourse.controls['modalidad'].errors && showErrorCurso"
                                            class="form-control customInput radius10" formControlName="modalidad">
                                                <option value=null>Selecciona la modalidad</option>
                                                <option value="En línea en vivo">En línea en vivo</option>
                                                <option value="Presencial">Presencial</option>
                                                <option value="Grabado">Grabado</option>
                                        </select>
                                        <div class="invalid-feedback" *ngIf="formNewCourse.controls['modalidad'].errors && showErrorCurso"> 
                                            Debe indicar la modalidad del diplomado
                                        </div>
                                    </div>
                                    <div class="form-group mgt08">
                                        <label class="ft12 " >Detalles Modalidad</label>
                                        <textarea
                                        [class.is-invalid]="formNewCourse.controls['modalidadCapacitacion'].errors && showErrorCurso"
                                        formControlName="modalidadCapacitacion" 
                                        class="form-control customInput2 radius6" 
                                        placeholder="Escriba la duración del curso en minutos aquí"
                                        rows="3"></textarea>
                                        <div class="invalid-feedback" *ngIf="formNewCourse.controls['modalidadCapacitacion'].errors && showErrorCurso"> 
                                            Debe indicar el detalle de la modalidad de capacitación
                                        </div>
                                    </div>
                                    <!-- <div class="form-group mgt08">
                                        <label class="ft12 " >Duración (minutos)</label>
                                        <input
                                        [class.is-invalid]="formNewCourse.controls['duracion'].errors && showErrorCurso"
                                        formControlName="duracion" type="number" class="form-control customInput2 radius6 " placeholder="Escriba el duración del diplomado en minutos aquí">
                                        <div class="invalid-feedback" *ngIf="formNewCourse.controls['duracion'].errors && showErrorCurso"> 
                                            Debe indicar la duración del diplomado
                                        </div>
                                    </div> -->
                                    <div class="form-group mgt08">
                                        <label class="ft12 " >Duración</label>
                                        <input
                                        [class.is-invalid]="formNewCourse.controls['duracion'].errors && showErrorCurso"
                                        formControlName="duracion" type="text" class="form-control customInput2 radius6 " placeholder="Escriba el duración del diplomado en minutos aquí">
                                        <div class="invalid-feedback" *ngIf="formNewCourse.controls['duracion'].errors && showErrorCurso"> 
                                            Debe indicar la duración del diplomado
                                        </div>
                                        <div class="invalid-feedback" *ngIf="formNewCourse.controls['duracion'].errors && showErrorCurso"> 
                                            Debe indicar las fechas de las sesiones del curso
                                        </div>
                                    </div>
                                    <label>Fecha inicio</label>
                                    <div style="position: relative">
                                        <img [src]="icon.calendarAdd" class="makeGray h16px" alt="" style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%);">
                                        <input formControlName="fechaInicio" [class.is-invalid]="formNewCourse.get('fechaInicio').errors && showErrorCurso" type="date" class="form-control pdl20 radius6 shadow-animation borderLight" placeholder="Ingrese los detalles de las fechas de las seciones">
                                    </div>
                                    <div class="form-group mgt08">
                                        <label class="ft12 " >Fecha sesiones</label>
                                        <textarea
                                        [class.is-invalid]="formNewCourse.controls['fehcaSesiones'].errors && showErrorCurso"
                                        formControlName="fehcaSesiones" 
                                        class="form-control customInput2 radius6" 
                                        placeholder="Escriba la duración del curso en minutos aquí"
                                        rows="3"></textarea>
                                        <div class="invalid-feedback" *ngIf="formNewCourse.controls['fehcaSesiones'].errors && showErrorCurso"> 
                                            Debe indicar las fechas de las sesiones del curso
                                        </div>
                                    </div>
                                    <div class="form-group mgt08">
                                        <label class="ft12 " >Día sesiones</label>
                                        <textarea
                                        [class.is-invalid]="formNewCourse.controls['diaSesiones'].errors && showErrorCurso"
                                        formControlName="diaSesiones" 
                                        class="form-control customInput2 radius6" 
                                        placeholder="Escriba la duración del curso en minutos aquí"
                                        rows="3"></textarea>
                                        <div class="invalid-feedback" *ngIf="formNewCourse.controls['diaSesiones'].errors && showErrorCurso"> 
                                            Debe indicar las fechas de las sesiones del curso
                                        </div>
                                    </div>
                                    <!-- diaSesiones -->
                                    <div fxLayout="row" fxLayoutAlign=" center" class="mgt10 fw">
                                        <form class="fw">
                                            <mat-form-field class="example-full-width fw">
                                                <mat-label>Buscar Pilar</mat-label>
                                                <input type="text" class="ft14 fw" placeholder="Seleccione uno" aria-label="Number" matInput #autoTrigger="matAutocompleteTrigger" [formControl]="pillarsForm" [matAutocomplete]="autoPillars">
                                                <mat-autocomplete [displayWith]="getOptionTextPillar" #autoPillars="matAutocomplete" class="options">
                                                <mat-option (click)="changePillar(option)" class="multiline-mat-option ft12" *ngFor="let option of filteredPillars | async" [value]="option">
                                                    <div fxLayout="row" fxLayoutAlign="space-between">
                                                        <div fxLayout="col" fxLayoutAlign="center center">
                                                            {{option.name | titlecase}}
                                                        </div>
                                                    </div>
                                                </mat-option>
                                                <mat-option  (click)="createPillar()" class="multiline-mat-option" value="null">Crear nuevo pilar</mat-option>
                                                </mat-autocomplete>
                                            </mat-form-field>
                                        </form>
                                    </div>
                                    <div class="form-group mgt08">
                                        <label class="ft12 " >Que Incluye</label>
                                        <textarea
                                        [class.is-invalid]="formNewCourse.controls['queIncluye'].errors && showErrorCurso"
                                        formControlName="queIncluye" 
                                        class="form-control customInput2 radius6" 
                                        placeholder="Escriba la duración del diplomado en minutos aquí"
                                        rows="3"></textarea>
                                        <div class="invalid-feedback" *ngIf="formNewCourse.controls['queIncluye'].errors && showErrorCurso"> 
                                            Debe indicar las fechas de las sesiones del diplomado
                                        </div>
                                    </div>
                                    <div class="form-group mgt08">
                                        <label class="ft12 " >A quien va dirigido</label>
                                        <textarea
                                        [class.is-invalid]="formNewCourse.controls['aQuienVaDirigido'].errors && showErrorCurso"
                                        formControlName="aQuienVaDirigido" 
                                        class="form-control customInput2 radius6" 
                                        placeholder="Escriba la duración del diplomado en minutos aquí"
                                        rows="3"></textarea>
                                        <div class="invalid-feedback" *ngIf="formNewCourse.controls['aQuienVaDirigido'].errors && showErrorCurso"> 
                                            Debe indicar las fechas de las sesiones del diplomado
                                        </div>
                                    </div>
                                    <div class="form-group mgt08">
                                        <label class="ft12 " >Descuentos</label>
                                        <textarea
                                        [class.is-invalid]="formNewCourse.controls['descuentos'].errors && showErrorCurso"
                                        formControlName="descuentos" 
                                        class="form-control customInput2 radius6" 
                                        placeholder="Escriba el texto de descuentos"
                                        rows="3"></textarea>
                                        <div class="invalid-feedback" *ngIf="formNewCourse.controls['descuentos'].errors && showErrorCurso"> 
                                            Debe indicar las fechas de las sesiones del diplomado
                                        </div>
                                    </div>
                                    <div *ngIf="user?.isSystemUser" class="form-group mgt08">
                                        <label class="ft12">URL personalizado</label>
                                        <div class="input-group">
                                            <input
                                            [class.is-invalid]="formNewCourse.controls['customUrl'].errors && showErrorCurso"
                                            formControlName="customUrl"
                                            type="text"
                                            class="form-control customInput2 radius6"
                                            placeholder="Escriba el URL del diplomado aquí"
                                            >
                                            <div class="input-group-append">
                                                <span class="input-group-text">{{ formNewCourse?.controls['customUrl']?.value?.length || 0 }}</span>
                                            </div>
                                        </div>
                                        <div class="invalid-feedback" *ngIf="formNewCourse?.controls['customUrl']?.errors && showErrorCurso">
                                            Debe indicar el URL del diplomado
                                        </div>
                                    </div>
                                    <div class="ft12 form-group pdt10">
                                        <label>Descripción del Diplomado</label>
                                        <textarea [class.is-invalid]="formNewCourse.controls['descripcion'].errors && showErrorCurso"
                                        rows="3"  formControlName="descripcion" type="text" class="form-control ft12  customInput2" 
                                        placeholder="Escriba la descripción del Diplomado aquí" style="resize: none;"></textarea>
                                        <div class="invalid-feedback" *ngIf="formNewCourse.controls['descripcion'].errors && showErrorCurso"> 
                                            Debe indicar la descripción del Diplomado
                                        </div>
                                    </div>
                                    <div class="form-group pdt10">
                                        <label class="ft12 pdb05 "  >Foto del Diplomado</label>
                                        <div fxLayout="column" fxLayoutAlign="start strech" >
                                                <!-- <button class="add-button">Adjuntar nueva</button> -->
                                                <input #cursoImage type="file" (change)="uploadCourseImage($event,'curso')" hidden accept="image/jpeg, image/png,image/webp" />
                                                <!-- <div class="image-scroll">
                                                    <img *ngFor="let imagen of imagenesCurso" (click)="seleccionarImagenCurso(imagen)" [src]="imagen" alt="Imagen seleccionada" class="image cursorPointer {{this.formNewCourse.get('imagen').value == imagen? 'img-active': ''}}">
                                                </div> -->
                                                <img *ngIf="formNewCourse.get('imagen').value" [src]="formNewCourse.get('imagen').value" alt="Imagen seleccionada" class="h200px radius6 mgb10" style="object-fit: contain;">
                                                <div class="fw" >
                                                    <button (click)="cursoImage.click()" class="grayButton pd03 radius6 ft12 ft500 h28px mgr10 gray-8" fxLayoutGap="0.625" >
                                                        <img [src]="icon.arrowUp" class="h16px pdr05" alt="">
                                                        Adjuntar imagen
                                                    </button>
                                                </div>
                                        </div>
                                    </div>
                                    <div *ngIf="formNewCourse.controls['imagen'].errors && showErrorCurso" class="custom-invalid-feedback pdt05">
                                        Debe seleccionar o subir la imagen del diplomado
                                    </div> 
                                    
                                    <div class="form-group pdt10">
                                        <label class="ft12 pdb05 "  >Banner del Diplomado</label>
                                        <div fxLayout="column" fxLayoutAlign="start strech" >
                                                <input #cursoBanner type="file" (change)="uploadCourseImage($event,'banner')" hidden accept="image/jpeg, image/png,image/webp" />
                                                <img *ngIf="formNewCourse.get('banner').value" [src]="formNewCourse.get('banner').value" alt="Imagen seleccionada" class="h200px radius6 mgb10" style="object-fit: contain;">
                                                <div class="fw" >
                                                    <button (click)="cursoBanner.click()" class="grayButton pd03 radius6 ft12 ft500 h28px mgr10 gray-8" fxLayoutGap="0.625" >
                                                        <img [src]="icon.arrowUp" class="h16px pdr05" alt="">
                                                        Adjuntar banner
                                                    </button>
                                                </div>
                                        </div>
                                    </div>
                                    <div *ngIf="formNewCourse.controls['banner'].errors && showErrorCurso" class="custom-invalid-feedback pdt05">
                                        Debe seleccionar o subir la banner del diplomado
                                    </div>  
                                    <div class="form-group pdt10">
                                        <label class="ft12 pdb05 "  >PDF del Diplomado</label>
                                        <div fxLayout="column" fxLayoutAlign="start strech" >
                                                <input #cursoPDF type="file" (change)="uploadCourseImage($event,'pdf')" hidden accept="application/pdf" />
                                                <!-- <span  (click)="descargarArchivo(formNewCourse.get('pdf').value)" *ngIf="formNewCourse.get('pdf').value" class="pdb10 blueLink">
                                                    {{formNewCourse.get('pdf').value.nombre}}
                                                </span> -->
                                                <div *ngIf="formNewCourse.get('pdf').value" fxLayout="row" fxLayoutAlign="start center" class="pdb10">
                                                    <span (click)="descargarArchivo(formNewCourse.get('pdf').value)" class="blueLink cursorPointer">{{formNewCourse.get('pdf').value.nombre}}</span>
                                                    <img (click)="deleteFileClass(formNewCourse.get('pdf').value)"   class="makeRed cursorPointer" [src]="icon.trash" alt="">
                                                    <!-- <span (click)="deleteFileClass(formNewCourse.get('pdf').value)" class="blueLink mgr05">Eliminar</span> -->
                                                    <!-- <button (click)="structureActivity(modalClaseDetail,clase,modulo)" class="grayButton pd03 radius4 ft12 h28px mgr10 w130px" fxLayout="row" fxLayoutGap="0.625" fxLayoutAlign="center center">
                                                        <img [src]="icon.folderUp" class="h16px pdr05" alt="">Ver archivo
                                                    </button> -->
                                                    <!-- <button (click)="descargarArchivo(formNewCourse.get('pdf').value)" class="grayButton pd03 radius4 ft12 h28px mgr10 w130px" fxLayout="row" fxLayoutGap="0.625" fxLayoutAlign="center center">
                                                        <img [src]="icon.pdf" class="h16px pdr05" alt="">Ver archivo
                                                    </button> -->
                                                </div>
                                                <!-- <img *ngIf="formNewCourse.get('banner').value" [src]="formNewCourse.get('banner').value" alt="Imagen seleccionada" class="h200px radius6 mgb10" style="object-fit: contain;"> -->
                                                <div class="fw" >
                                                    <button (click)="cursoPDF.click()" class="grayButton pd03 radius6 ft12 ft500 h28px mgr10 gray-8" fxLayoutGap="0.625" >
                                                        <img [src]="icon.arrowUp" class="h16px pdr05" alt="">
                                                        Adjuntar PDF
                                                    </button>
                                                </div>
                                        </div>
                                    </div>
                                    <div *ngIf="formNewCourse.controls['pdf'].errors && showErrorCurso" class="custom-invalid-feedback pdt05">
                                        Debe seleccionar o subir la PDF del diplomado
                                    </div>  
                                </form>
                            </div>
                            <div class="column w-70 mgr25 fh" fxLayoutGap="2rem" style="margin-bottom: 15px;" >
                                    <div  class=" mgt15  mgl10 fw" fxLayout="column">
                                        <div fxLayout="column" class=" radius10  shadowLight" style=" background-color:rgba(244, 244, 244, 0.362); margin-bottom: 50px !important; overflow-y: auto; max-height: 150vh;">
                                            <div>
                                                <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap=".5rem" class="mgl10 mgt15 mgr10">
                                                    <img [src]="icon.document" class="makeBlue h20px" alt="">
                                                    <span class="ft500 ft14 black " style="margin-top: 5px;">Contenido del diplomado - {{getDurationModuleCourse()}} Horas</span>
                                                </div>
                                                <div class="pdl10 pdr10 pdt10 fw ">
                                                    <div fxLayout="column" class="fw fh mgb20"> 
                                                        <!-- aqui alejandra -->
                                                        <!-- aqui van los modulos que se van creando -->
                                                        <div *ngFor="let modulo of modulos; let iModulo = index" class="{{modulo['isInvalid']? 'ContainerModuloInvalid' : 'ContainerModulo'}}">
                                                            <div fxLayout="row" fxLayoutAlign="space-between start" class="fw  pd08  ">
                                                                <div fxLayout="row" fxLayoutGap="10px" class="fw">
                                                                    <div class="ft500 ft12 p ">
                                                                        <!-- numero del modulo -->
                                                                        Módulo {{modulo.numero}}:
                                                                    </div>
                                                                    <div class="ft12">
                                                                        <!-- nombre del modulo -->
                                                                        <!-- <img [src]="icon.document" class="h12px pdr05 makeGray" alt=""> -->
                                                                        <div *ngIf="modulo.titulo && !modulo['editarTitulo']; then tituloPresente; else ModuloSinTitulo"></div>
                                                                        <ng-template #tituloPresente>
                                                                            <span (click)="modulo['editarTitulo'] = true;modulo['tituloTMP'] = modulo?.titulo">
                                                                                {{modulo.titulo}}
                                                                            </span>
                                                                            <!-- <img (click)="modulo['editarTitulo'] = true;modulo['tituloTMP'] = modulo?.titulo" [src]="icon.licencias" class="h18px pdl05 makeGray edit cursorPointer" alt=""> -->
                                                                        </ng-template>
                                                                        <ng-template #ModuloSinTitulo>
                                                                            <input #inputRefModulo *ngIf="!modulo.titulo" 
                                                                                   type="text" 
                                                                                   [(ngModel)]="modulo['tituloTMP']" 
                                                                                   (keyup.enter)="confirmarTitulo(modulo)" 
                                                                                   placeholder="Escriba título aquí" 
                                                                                   class="inputInvisible">
                                                                            <input #inputRefModulo *ngIf="modulo.titulo" 
                                                                                   type="text" 
                                                                                   [(ngModel)]="modulo['tituloTMP']" 
                                                                                   (keyup.enter)="confirmarTitulo(modulo)" 
                                                                                   [value]="modulo.titulo" 
                                                                                   placeholder="Escriba título aquí" 
                                                                                   class="inputInvisible">
                                                                            <img (click)="confirmarTitulo(modulo)" 
                                                                                 matTooltip="Confirmar título" 
                                                                                 [src]="icon.check" 
                                                                                 class="h18px pdl05 makeGray edit cursorPointer" 
                                                                                 alt="">
                                                                        </ng-template>
                                                                    </div>
                                                                </div>
                                                                <div fxLayout="row" fxLayoutAlign="space-between start" fxLayoutGap="0.625">
                                                                    <img (click)="deleteModule(modulo)" [src]="icon.trash" class="h16px pdr05 cursorPointer trash" alt="">
                                                                    <img *ngIf="modulo['expanded']" (click)="expandModulo(modulo); hideModuleClasses(modulo)" [src]="icon.chevronUp" class="h16px pdr05 cursorPointer" alt="">
                                                                    <img *ngIf="!modulo['expanded']" (click)="expandModulo(modulo); hideOtherModules(modulo)" [src]="icon.chevronDown" class="h16px pdr05 cursorPointer" alt="">                                                       
                                                                </div>
                                                            </div>
                                                            <!-- Contenedor de las clases -->
                                                            <div *ngIf="modulo['expanded']">
                                                                <!-- Contenedor Principal -->

                                                                <div *ngFor="let clase of modulo['clases']; trackBy: trackByClase; let iClase = index" fxLayout="row" class="fw">
                                                                    <div *ngIf="!clase?.activity?.autoGenerated" class="mgl10 mgt03 mgr10 fw">
                                                                        <div class="fw mgb10">
                                                                            <mat-accordion multi="false" class="fw">
                                                                                <mat-expansion-panel [ngClass]="{'ContainerClase': clase['isInvalid']}" [disabled]="!clase.titulo" [expanded]="clase['expanded'] || clase.tipo == 'video'" (opened)="closeOtherClasesModulo(clase,modulo)">                                                                        
                                                                                    <mat-expansion-panel-header>
                                                                                        <mat-panel-title (click)="onPanelTitleClick($event)" fxLayout="row" fxLayoutAlign="space-between center">
                                                                                            <div fxLayout="row" fxLayoutAlign="start center">
                                                                                                <img [src]="icon[getIconClase(clase.tipo)]" class="h18px pdr05" alt="">
                                                                                                <div *ngIf="clase.titulo && !clase['editarTitulo']; then tituloPresenteClase; else ClaseSinTitulo"></div>
                                                                                                <ng-template #tituloPresenteClase>
                                                                                                    <span (click)="clase['editarTitulo'] = true; clase['tituloTMP'] = clase?.titulo; editarTituloClase(iClase)">{{'Sesión' | titlecase }} {{iClase + 1}}: {{clase.titulo}}</span>
                                                                                                </ng-template>
                                                                                                <ng-template #ClaseSinTitulo>
                                                                                                    <input #inputRef *ngIf="!clase.titulo" type="text" [(ngModel)]="clase['tituloTMP']" (keydown.space)="preventDefault($event)" (keyup.enter)="preventDefault($event);confirmarTituloClase(clase)" placeholder="Escriba título aquí" class="inputInvisible">
                                                                                                    <input #inputRef *ngIf="clase.titulo" type="text" [(ngModel)]="clase['tituloTMP']" (keydown.space)="preventDefault($event)" (keyup.enter)="preventDefault($event);confirmarTituloClase(clase)" placeholder="Escriba título aquí" class="inputInvisible">
                                                                                                    <img (click)="confirmarTituloClase(clase)" matTooltip="Confirmar título" [src]="icon.check" class="h18px pdl05 makeGray edit cursorPointer" alt="">
                                                                                                </ng-template>
                                                                                            </div>
                                                                                            <div fxLayout="row" fxLayoutAlign="space-between center">
                                                                                                <ng-container *ngIf="clase.tipo == 'video'">
                                                                                                    <div *ngIf="!clase.vimeoId1">
                                                                                                        <span (click)="FileInputTitle.click()" *ngIf="clase.titulo && !clase['videoUpload'] && !clase['uploading']" class="blueLink mgr10">Agregar video</span>
                                                                                                        <div *ngIf="clase.tipo == 'video' && clase['videoUpload']">
                                                                                                            <span *ngIf="clase['videoUpload']<100 && clase['videoUpload']>0" class="pdl05 mgr10">Subiendo video: {{clase['videoUpload']}}%</span>
                                                                                                        </div>
                                                                                                        <span *ngIf="!clase.titulo" class="gray-6 cursorPointer mgr10">Agregar video</span>
                                                                                                        <input (change)="onFileSelected($event,clase,false,modulo)" type="file" accept="{{clase.tipo == 'lectura'?'.pdf' : 'video/mp4'}}" #FileInputTitle style="display: none;">
                                                                                                    </div>
                                                                                                    <div *ngIf="clase.vimeoId1" fxLayout="row" fxLayoutAlign="start center">
                                                                                                        <span (click)="quitarVideoClase(clase)" class="blueLink mgr05">Eliminar</span>
                                                                                                        <button (click)="verVideoVimeo(clase)" class="grayButton pd03 radius4 ft12 h28px mgr10 w130px" fxLayout="row" fxLayoutGap="0.625" fxLayoutAlign="center center">
                                                                                                            <img [src]="icon.playOutline" class="h16px pdr05" alt="">
                                                                                                            Reproducir video
                                                                                                        </button>
                                                                                                        <button  *ngIf="user.isSystemUser"  (click)="abrirEnVimeo(clase)" class="grayButton pd03 radius4 ft12 h28px mgr10 w130px" fxLayout="row" fxLayoutGap="0.625" fxLayoutAlign="center center">
                                                                                                            <img [src]="icon.send" class="h16px pdr05" alt="">
                                                                                                            Abrir en Vimeo
                                                                                                        </button>
                                                                                                    </div>
                                                                                                </ng-container>

                                                                                                <ng-container *ngIf="clase.tipo == 'lectura'">
                                                                                                    <div *ngIf="!clase.vimeoId1">
                                                                                                        <!-- <span (click)="FileInputTitle.click()" *ngIf="clase.titulo && !clase['uploading'] && !clase?.archivos[0]" class="blueLink mgr10">Agregar archivo</span> -->
                                                                                                        <!-- <span *ngIf="!clase.titulo" class="gray-6 cursorPointer mgr10">Agregar archivo</span> -->
                                                                                                        <input (change)="onFileSelected($event,clase,false,modulo)" type="file" accept="{{clase.tipo == 'lectura'?'.pdf' : 'video/mp4'}}" #FileInputTitle style="display: none;">
                                                                                                    </div>
                                                                                                </ng-container>
                                                                                                <img (click)="borrarClase(modulo,clase)" [src]="icon.trash" class="h16px trash" alt="">
                                                                                            </div>
                                                                                        </mat-panel-title>
                                                                                    </mat-expansion-panel-header>
                                                                                    

                                                                                    <!-- si es de archivo es un drop -->
                                                                                    <ng-container>
                                                                                        <div fxLayout="row" fxLayoutAlign="center center" class="mgt15 mgb05">
                                                                                            <div fxLayout="row" fxLayoutAlign="center center">
                                                                                                <form class="example-form">
                                                                                                    <mat-form-field class="example-full-width fw">
                                                                                                    <mat-label>Buscar Instructor</mat-label>
                                                                                                    <input type="text"
                                                                                                        class="ft14 fw"   
                                                                                                        placeholder="Seleccione uno"
                                                                                                        aria-label="Number"
                                                                                                        matInput
                                                                                                        #autoTrigger="matAutocompleteTrigger"
                                                                                                        [formControl]="clase['instructoresForm']"
                                                                                                        [matAutocomplete]="autoInstructores">
                                                                                                    <mat-autocomplete [displayWith]="getOptionText" #autoInstructores="matAutocomplete" class="options">
                                                                                                        <mat-option (click)="setInstructor(option,clase)" class="multiline-mat-option" *ngFor="let option of clase['filteredinstructores'] | async" [value]="option">
                                                                                                        <div fxLayout="row" fxLayoutAlign="space-between">
                                                                                                            <div fxLayout="col" fxLayoutAlign="center center" class="ft12">
                                                                                                            {{option.nombre | titlecase}}
                                                                                                            </div>
                                                                                                        </div>
                                                                                                        </mat-option>
                                                                                                        <!-- <mat-option  (click)="createInstructor()" class="multiline-mat-option" value="null">Crear nuevo instructor</mat-option> -->
                                                                                                    </mat-autocomplete>
                                                                                                    </mat-form-field>
                                                                                                </form>
                                                                                            </div>
                                                                                            <div fxLayout="row" class="fw" fxLayoutAlign="space-around center" >
                                                                                                <div fxLayout="row" fxLayoutAlign="center center">
                                                                                                    <div>
                                                                                                        <span>Fecha:</span>
                                                                                                    </div>
                                                                                                    <div style="position: relative">
                                                                                                        <img [src]="icon.calendarAdd" class="makeGray h16px" alt="" style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%);">
                                                                                                        <input [(ngModel)]="clase['fechaInicio']" type="date" class="form-control pdl20 radius6 shadow-animation borderLight" placeholder="Ingrese los detalles de las fechas">
                                                                                                    </div>
                                                                                                </div>
                                                                                                <div fxLayout="row" fxLayoutAlign="center center">
                                                                                                    <div>
                                                                                                        <span>Duración (en horas):</span>
                                                                                                    </div>
                                                                                                    <div>
                                                                                                        <input [(ngModel)]="clase['duracion']" type="number" class="form-control radius6 shadow-animation borderLight" placeholder="duración">
                                                                                                    </div>
                                                                                                </div>
                                                                                            </div>
                                                                                        </div>
                                                                                        <div class="pdt10" fxLayout="row" fxLayoutGap="1rem" fxLayoutAlign="start start">
                                                                                            <!-- Columna izquierda: Imagen y botón -->
                                                                                            <div fxFlex="45" fxLayout="column" fxLayoutAlign="start stretch">
                                                                                                <label class="ft12 pdb05">Imagen sesión</label>
                                                                                                <div fxLayout="column" fxLayoutAlign="start stretch">
                                                                                                    <input 
                                                                                                        [id]="'imgClase-' + modulo.numero + '-' + iClase"
                                                                                                        type="file" 
                                                                                                        (change)="uploadCourseImage($event,'clase',null,clase)" 
                                                                                                        hidden 
                                                                                                        accept="image/jpeg, image/png, image/webp" 
                                                                                                    />
                                                                                                    <img 
                                                                                                        *ngIf="clase['image']" 
                                                                                                        [src]="clase['image']" 
                                                                                                        alt="Imagen seleccionada" 
                                                                                                        class="radius6 mgb10" 
                                                                                                        style="object-fit: contain; height: 124px;"
                                                                                                    />
                                                                                                    <div class="fw">
                                                                                                        <button 
                                                                                                            (click)="clickAddImgClase(modulo,iClase)"  
                                                                                                            class="grayButton pd03 radius6 ft12 ft500 h28px mgr10 gray-8" 
                                                                                                            fxLayoutGap="0.625">
                                                                                                            <img [src]="icon.arrowUp" class="h16px pdr05" alt="">
                                                                                                            Adjuntar Imagen
                                                                                                        </button>
                                                                                                    </div>
                                                                                                </div>
                                                                                            </div>
                                                                                            
                                                                                            <!-- Columna derecha: Textarea -->
                                                                                            <div fxFlex="55" fxLayout="column" fxLayoutAlign="start stretch">
                                                                                                <label class="ft12 pdb05">Descripción</label>
                                                                                                <textarea 
                                                                                                    [id]="'descClase-' + modulo.numero + '-' + iClase" 
                                                                                                    [(ngModel)]="clase.descripcion" 
                                                                                                    class="form-control ft12 customInput2" 
                                                                                                    rows="5" 
                                                                                                    placeholder="Escribe una descripción..." 
                                                                                                    style="resize: none;">
                                                                                                </textarea>
                                                                                            </div>
                                                                                        </div>
                                                                                        
                                                                                    </ng-container>
                                                                                    <ng-container *ngIf="clase['isInvalid']">
                                                                                        <div class="mgl05 mgr10 fw" *ngFor="let mensaje of clase['InvalidMessages']" fxLayoutAlign="start center">
                                                                                            <mat-icon class="red-5 ft16">info</mat-icon>
                                                                                            <span class="redText">{{mensaje}}</span>
                                                                                        </div>
                                                                                    </ng-container>
                                                                                </mat-expansion-panel>
                                                                            </mat-accordion>
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                                <div *ngIf="!modulo['addClassMode']" fxLayout="row" class="fw mg10" fxLayoutAlign="center center">
                                                                    <span (click)="modulo['addClassMode'] = !modulo['addClassMode'];addClase('lectura',modulo); modulo['addClassMode'] = false" class="blueLink radius4 ft12 h28px no-select">
                                                                        <img [src]="icon.addNew" class="h12px pdr05 makeBlue" alt="">
                                                                        Agregar sesión
                                                                    </span>
                                                                </div>

                                                                <!-- <div fxLayout="row" class="fw" fxLayoutAlign="space-around center" >
                                                                    <div fxLayout="row" fxLayoutAlign="center center">
                                                                        <div>
                                                                            <span>Fecha:</span>
                                                                        </div>
                                                                        <div style="position: relative">
                                                                            <img [src]="icon.calendarAdd" class="makeGray h16px" alt="" style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%);">
                                                                            <input [(ngModel)]="modulo['fechaInicio']" type="date" class="form-control pdl20 radius6 shadow-animation borderLight" placeholder="Ingrese los detalles de las fechas">
                                                                        </div>
                                                                    </div>
                                                                    <div fxLayout="row" fxLayoutAlign="center center">
                                                                        <div>
                                                                            <span>Duración (en horas):</span>
                                                                        </div>
                                                                        <div>
                                                                            <input [(ngModel)]="modulo['duracion']" type="number" class="form-control radius6 shadow-animation borderLight" placeholder="duración">
                                                                        </div>
                                                                    </div>
                                                                </div> -->
                                                                <ng-container *ngIf="modulo['isInvalid']">
                                                                    <div class="mgl08 fw"    
                                                                      [ngClass]="{'mgb10':i+1 == modulo['InvalidMessages'].length}"      
                                                                      *ngFor="let mensaje of modulo['InvalidMessages']; let i = index" fxLayoutAlign="start center">
                                                                        <mat-icon class="red-5 ft16">info</mat-icon>
                                                                        <span class="redText">{{mensaje}}</span>
                                                                    </div>
                                                                </ng-container>
                                                            </div>
                                                        </div>
                                                        <div fxLayout="row" fxLayoutAlign="center center">
                                                            <span (click)="addModulo()" class="blueLink radius4 ft12 h28px no-select" fxLayout="row" fxLayoutGap="0.625" fxLayoutAlign="center center">
                                                                <img [src]="icon.addNew" class="h12px pdr05 makeBlue" alt="">
                                                                Agregar Módulo
                                                            </span>
                                                        </div>                                                    
                                                        <ng-container *ngIf="isInvalidCases">
                                                            <div class="pdt05 fw" *ngFor="let mensaje of invalidMessages" fxLayoutAlign="start center">
                                                                <mat-icon class="red-5 ft16">info</mat-icon>
                                                                <span class="redText">{{mensaje}}</span>
                                                            </div>
                                                        </ng-container>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                            </div>
                        </div>
                    </ng-container>
                </mat-tab>
            </mat-tab-group>
        </div>
    </div>
    
    <!-- endCourseModal -->
    <ng-template #endCourseModal let-modal>
        <div class="modal-header bg-web-primary text-white px-3 py-1">
            <div class="modal-title pd10" fxLayout="row" fxLayoutAlign="start center">
                <img [src]="icon.catalog" class="h18px pdr05" alt="">
                <span class="ft16 ft600 gray-10">¡Creaste un nuevo diplomado!</span>
            </div>
            <img style="cursor: pointer;" [src]="icon.close" (click)="modal.dismiss('Cross click')" class="h20px"  alt="">
        </div>
        <div class="modal-body">
            <div fxLayout="row" class="fw">
                <!-- Espacio para la imagen -->
                <div fxFlex="50" fxLayout="row" fxLayoutAlign="center center">
                    <img src="../../../assets/images/cursos/teamwork high five-pana.svg" alt="Descripción" class="w-80">
                </div>
        
                <!-- Espacio para el texto y los botones -->
                <div fxFlex="50" fxLayout="column" fxLayoutAlign="center center">
                    <!-- Texto encima de los botones -->
                    <div class="text-center mb-3">
                        ¿Deseas publicar el diplomado?
                    </div>
        
                    <!-- Botones -->
                    <div fxLayout="row" fxLayoutAlign="space-around center">
                        <button class="yellowButton radius4 ft12 h28px" fxLayout="row" fxLayoutGap="0.625" fxLayoutAlign="center center">
                            <img [src]="icon.save" class="h16px makeWhite pdr05" alt="">
                            Más tarde
                        </button>
                        <button class="blueButton radius4 ft12 h28px mgl10 gray-1" fxLayout="row" fxLayoutGap="0.625" fxLayoutAlign="center center">
                            Publicar
                            <img [src]="icon.send" class="h16px makeWhite pdl05" alt="">
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </ng-template>
</ng-container>



