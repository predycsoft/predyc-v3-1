<app-navigate-back class="ft600 ft16 gray-10" targetUrl="/admin/articles">Artículos</app-navigate-back>
<div fxLayout="column" fxLayoutAlign="center center" fxLayoutGap="3rem" class="fw pd20">
    <div style="display: flex; flex-direction: row; gap: 20px; margin-top: 20px; justify-content: center;">
        <!-- <button (click)="format = 'html'" class="blueButton">HTML</button>
        <button (click)="format = 'object'" class="blueButton">Object</button>
        <button (click)="format = 'json'" class="blueButton">Json</button>
        <button (click)="format = 'text'" class="blueButton">Text</button>
        <button (click)="debug()" class="blueButton">Print result</button> -->
        <button (click)="save()" class="blueButton">Save result</button>
    </div>
    <div fxLayout="column" fxLayoutAlign="center start" fxLayoutGap=".5rem" class="w-60">

        <!-- Title -->
        <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="1.5rem" class="">
            <span class="w60px">Título:</span>
            <input type="text" [(ngModel)]="title" class="ft14 shadow-animation pdl05 pdr05 radius4 borderLight"
                style="text-align: center; width: 32vw;" />
        </div>

        <!-- Summary -->
        <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="1.5rem" class="">
            <span class="w60px">Resumen:</span>
            <textarea class="form-control radius4" style="overflow-y: hidden; resize:none; background-color: transparent !important; width: 32vw; height: 100px;" 
            type="text" maxlength="180" [(ngModel)]="summary" class="ft12 borderLight"></textarea> 
        </div>

        <!-- Slug -->
        <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="1.5rem" class="">
            <span class="w60px">Slug:</span>
            <input id="slug" name="slug" [(ngModel)]="slug" #slugCtrl="ngModel" class="ft14 shadow-animation pdl05 pdr05 radius4 borderLight" 
            required pattern="^[a-z0-9]+(?:-[a-z0-9]+)*$" />
        </div>
        <div *ngIf="slugCtrl.invalid && slugCtrl.touched">
            <span style="color: red" *ngIf="slugCtrl.errors?.required">Slug is required.</span>
            <span style="color: red" *ngIf="slugCtrl.errors?.pattern">Invalid slug format.</span>
        </div>

        <!-- Author -->
        <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="1.5rem" class="">
            <span class="w60px">Autor:</span>
            <select [(ngModel)]="selectedAuthorId" class="ft14 shadow-animation pdl05 pdr05 borderLight cursorPointer" style="text-align: center; width: 23vw;">
                <option *ngFor="let author of authors" [value]="author.id">{{ author.name }}</option>
            </select>
        </div>

        <!-- Categories -->
        <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="1.5rem" class="">
            <span class="w60px">Categorias:</span>
            <select [(ngModel)]="selectedCategory" (change)="onCategoryChange($event)" class="ft14 shadow-animation pdl05 pdr05 borderLight cursorPointer" style="text-align: center; width: 23vw;">
                <option value="" disabled selected>Selecciona las categorias</option>
                <option *ngFor="let category of categoriesOptions" [value]="category">{{ category }}</option>
            </select>
        </div>
        <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap=".5rem" class="margin-left-custom">
            <div *ngFor="let category of categories; let categoryIndex = index" class="skill-badge-complete ListHover radius10 backGray2 ft12 pdl08 pdr08 gray-8">
                <span>{{ category | titlecase }}</span>
                <img style="cursor: pointer" (click)="removeCategory(categoryIndex)" [src]="icon.close" class="h16px makeGray" alt="" />
            </div>
        </div>

        <!-- Pillars -->
        <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="2.5rem" class="cursorPointer">
            <span class="w60px">Pilares:</span>
            <form class="fw">
                <mat-form-field class="example-full-width fw">
                    <mat-label>Buscar pilar</mat-label>
                    <input type="text" class="ft14 fw" placeholder="Seleccione uno" aria-label="Number" matInput #pillarAutoTrigger="matAutocompleteTrigger" 
                    [formControl]="pillarsForm" [matAutocomplete]="autoPillars"/>
                    <mat-autocomplete [hideSingleSelectionIndicator]="true" [displayWith]="getOptionTextPillar" #autoPillars="matAutocomplete" class="options">
                        <mat-option (click)="changePillar(option)" class="multiline-mat-option ft12 fw" *ngFor="let option of filteredPillars | async" [value]="option">
                            <div fxLayout="row" fxLayoutAlign="space-between" class="fw">
                                <div fxLayout="col" fxLayoutAlign="center center">{{ option.name | titlecase }}</div>
                                <mat-icon class="makeBlue" *ngIf="isPillarSelected(option)">check</mat-icon>
                            </div>
                        </mat-option>
                        <mat-option (click)="createPillar(createPillarModal)" class="multiline-mat-option" value="null">
                            <span class="ft13 blueLink">Crear nuevo pilar</span>
                        </mat-option>
                    </mat-autocomplete>
                </mat-form-field>
            </form>
        </div>
        <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap=".5rem" class="margin-left-custom">
            <ng-container *ngFor="let pillar of articlePillars; let pillarIndex = index" class="margin-left-custom">
                <div class="skill-badge-complete ListHover radius10 backGray2 ft12 pdl08 pdr08 gray-8">
                    {{ pillar.name | titlecase }}
                    <img style="cursor: pointer" (click)="removePillar(pillarIndex)" [src]="icon.close" class="h16px makeGray" alt="" />
                </div>
            </ng-container>
        </div>

        <!-- Tags -->
        <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="1.5rem" class="cursorPointer">
            <span class="w60px">Etiquetas:</span>
            <form class="fw">
                <mat-form-field class="example-full-width fw">
                    <mat-label>Buscar etiqueta</mat-label>
                    <input  type="text" class="ft14 fw" placeholder="Seleccione uno" aria-label="Number" matInput #autoTrigger="matAutocompleteTrigger" 
                    [formControl]="tagsForm" [matAutocomplete]="autoTags"/>
                    <mat-autocomplete [hideSingleSelectionIndicator]="true" [displayWith]="getOptionTextTag" #autoTags="matAutocomplete" class="options">
                        <mat-option (click)="changeTag(option)" class="multiline-mat-option ft12 fw" *ngFor="let option of filteredTags | async" [value]="option">
                            <div fxLayout="row" fxLayoutAlign="space-between" class="fw">
                                <div fxLayout="col" fxLayoutAlign="center center">{{ option.name | titlecase }}</div>
                                <mat-icon class="makeBlue" *ngIf="isTagSelected(option)">check</mat-icon>
                            </div>
                        </mat-option>
                        <mat-option (click)="createTag(createTagModal)" class="multiline-mat-option" value="null">
                            <span class="ft13 blueLink">Crear nueva etiqueta</span>
                        </mat-option>
                    </mat-autocomplete>
                </mat-form-field>
            </form>
        </div>
        <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap=".5rem" class="margin-left-custom">
            <ng-container *ngFor="let tag of articleTags; let tagIndex = index" class="margin-left-custom">
                <div class="skill-badge-complete ListHover radius10 backGray2 ft12 pdl08 pdr08 gray-8">
                    {{ tag.name | titlecase }}
                    <img style="cursor: pointer" (click)="removeTag(tagIndex)" [src]="icon.close" class="h16px makeGray" alt="" />
                </div>
            </ng-container>
        </div>

        <!-- Photo -->
        <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="1.5rem" class="">
            <span class="w60px">Foto:</span>
            <div fxLayout="row" fxLayoutGap="1rem" fxLayoutAlign="start center">
                <button (click)="authorImage.click()" class="grayButton pd03 radius4 ft12 h28px mgr10 gray-8" fxLayout="row" fxLayoutGap="0.625" fxLayoutAlign="center center">
                    <img [src]="icon.arrowUp" class="h16px pdr05" alt="">
                    Adjuntar imagen
                </button>
                <input #authorImage type="file" (change)="setImage($event)" hidden accept="image/jpeg, image/png, image/webp" [src]="selectedFile">
                <div class="avatar-scroll">
                    <img *ngIf="previewImage" [src]="previewImage" alt="Imagen seleccionada" class="image shadow8">
                </div>
            </div>
        </div>
          

    </div>
    <quill-editor [modules]="modules" [format]="format" (onEditorCreated)="onEditorCreated($event)" class="w-60">
        <div above-quill-editor-toolbar>above</div>
        <div quill-editor-toolbar class="ql-toolbar">
            <span class="ql-formats">
                <!-- <button class="ql-header" value="2"></button> -->

                <select class="ql-header">
                    <option value="2">Heading 2</option>
                    <option value="3">Heading 3</option>
                    <option value="" selected>Normal</option>
                </select>

            </span>
            <span class="ql-formats">
                <button class="ql-bold"></button>
                <button class="ql-italic"></button>
                <!-- <button class="ql-underline"></button>
                <button class="ql-strike"></button> -->

            </span>
            <span class="ql-formats">
                <button class="ql-list" value="ordered"></button>
                <button class="ql-list" value="bullet"></button>
            </span>
            <span class="ql-formats">
                <button class="ql-blockquote"></button>
                <button class="ql-code-block"></button>
            </span>
            <span class="ql-formats">
                <select class="ql-align">
                    <option selected></option>
                    <option value="center"></option>
                    <option value="right"></option>
                    <option value="justify"></option>
                </select>
            </span>
            <!-- <span class="ql-formats">
                <button class="ql-script" value="sub"></button>
                <button class="ql-script" value="super"></button>
                <button class="ql-indent" value="-1"></button>
                <button class="ql-indent" value="+1"></button>
                <button class="ql-direction" value="rt1"></button>
            </span> -->
            <!-- <span class="ql-formats">
                <select class="ql-header">
                    <option selected></option>
                    <option value="1"></option>
                    <option value="2"></option>
                    <option value="3"></option>
                    <option value="4"></option>
                    <option value="5"></option>
                    <option value="6"></option>
                </select>
                <select class="ql-font">
                    <option selected></option>
                    <option value="serif"></option>
                    <option value="monospace"></option>
                </select>
                <select class="ql-size">
                    <option value="small"></option>
                    <option selected></option>
                    <option value="large"></option>
                    <option value="huge"></option>
                </select>
            </span> -->

            <!-- <span class="ql-formats">
                <select class="ql-color"></select>
                <select class="ql-background"></select>
            </span> -->

            <span class="ql-formats">
                <!-- <button class="ql-clean"></button> -->
                <button class="ql-link"></button>
                <button class="ql-image"></button>
                <!-- <button class="ql-video"></button> -->
            </span>
        </div>
        <div below-quill-editor-toolbar>below</div>
    </quill-editor>
</div>

<!-- Modal de tags -->
<ng-template #createTagModal let-modal>
    <div class="modal-header bg-web-primary text-white px-3 py-1" fxLayout="row" fxLayoutAlign="space-between center">
        <div class="modal-title pd10">
            <span class="ft16 ft500 gray-10">Asignar etiqueta</span>
        </div>
        <img style="cursor: pointer" [src]="icon.close" (click)="modal.dismiss('Cross click')" class="h20px" alt="" />
    </div>
    <div class="modal-body" style="overflow-y: auto; max-height: 80vh">
        <div fxLayout="row" class="fw">
            <div class="form-group fw">
                <label>Nombre de la etiqueta</label>
                <input type="text" class="form-control customInput" [(ngModel)]="newTagName" placeholder="Escriba el nombre de la etiqueta" />
            </div>
        </div>
        <div fxLayout="row" fxLayoutAlign="end end" class="pdt03" style="width: 100%">
            <button (click)="saveTag()" class="blueButton gray-1 radius4 ft12 h28px mgt10" fxLayout="row"
                fxLayoutGap="0.625rem" fxLayoutAlign="center center">
                <img [src]="icon.check" class="h16px pdr05 makeWhite" alt="" />
                Asignar etiqueta
            </button>
        </div>
    </div>
</ng-template>

<!-- Modal de pilares -->
<ng-template #createPillarModal let-modal>
    <div class="modal-header bg-web-primary text-white px-3 py-1" fxLayout="row" fxLayoutAlign="space-between center">
        <div class="modal-title pd10">
            <span class="ft16 ft500 gray-10">Asignar pilar</span>
        </div>
        <img style="cursor: pointer" [src]="icon.close" (click)="modal.dismiss('Cross click')" class="h20px" alt="" />
    </div>
    <div class="modal-body" style="overflow-y: auto; max-height: 80vh">
        <div fxLayout="row" class="fw">
            <div class="form-group fw">
                <label>Nombre del pilar</label>
                <input type="text" class="form-control customInput" [(ngModel)]="newPillarName" placeholder="Escriba el nombre del pilar" />
            </div>
        </div>
        <div fxLayout="row" fxLayoutAlign="end end" class="pdt03" style="width: 100%">
            <button (click)="savePillar()" class="blueButton gray-1 radius4 ft12 h28px mgt10" fxLayout="row"
                fxLayoutGap="0.625rem" fxLayoutAlign="center center">
                <img [src]="icon.check" class="h16px pdr05 makeWhite" alt="" />
                Asignar pilar
            </button>
        </div>
    </div>
</ng-template>